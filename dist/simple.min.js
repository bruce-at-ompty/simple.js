!function(t){"use strict"
String.prototype.hashCode=function(){var t,e,a,i=0
if(0===this.length)return i
for(t=0,a=this.length;a>t;t++)e=this.charCodeAt(t),i=(i<<5)-i+e,i|=0
return Math.abs(i)}
var e=function(t){return JSON.stringify(t)},a=function(t){return JSON.parse(JSON.stringify(t))},i=function(i,n){i=e(i).hashCode()
var s="_sj_"+i
if(this.name=i,t[s]=this,this.localStorageKey=s+"_data",this.container=null,this.state={},this.pState={},this.cnf={localStorageWrite:!0,localStorageRead:!0,partialRender:!0},this.callback={getElementStyle:{},renderElement:{},parseElementData:{},stateIsUpdated:{}},this.on=function(t,e,a){"object"==typeof this.callback[t]&&(this.callback[t][e]=a)},"object"==typeof n)for(var r in n)this.cnf[r]=n[r]
this.updateState=function(t,e){var a,i,n
if("string"==typeof t)a=t,i=e,this.state[t]=e
else if("object"==typeof t&&"string"==typeof t.nodeName){n=t
var s=n.nodeName,r=n.type
switch("SELECT"==s&&(r="select"),a=n.name,i=n.value,r){case"select":case"text":case"radio":this.state[a]=i
break
case"checkbox":if(this.state[a]||(this.state[a]=[]),n.checked&&i.length>0)this.state[a].indexOf(i)<0&&this.state[a].push(i)
else{var l=this.state[a].indexOf(i)
l>=0&&this.state[a].splice(l,1)}break
default:this.state[a]=i}}this.store(),this.stateIsUpdated({name:a,value:i,element:n,state:this.state})},this.stateIsUpdated=function(t){if("function"==typeof this.callback.stateIsUpdated[t.name]){var e=this.callback.stateIsUpdated[t.name]
return e(t)}return t},this.htmlTemplate=function(t,e){try{var a=t
for(var i in e)if(i.length>0){var n=new RegExp("{"+i+"}","g"),s=e[i]
a=a.replace(n,s)}return a}catch(r){return""}},this.store=function(){this.cnf.localStorageWrite&&"object"==typeof window.localStorage&&window.localStorage.setItem(this.localStorageKey,e(this.state))},this.load=function(){if(this.cnf.localStorageRead&&"object"==typeof window.localStorage){var t=window.localStorage.getItem(this.localStorageKey)
if(!t)return
try{this.state=JSON.parse(t)}catch(e){}}},this.template={main:{},sub:{}},this.data={},this.pData={},this.cache={},this.getElementStyle=function(t,a,i){if("function"==typeof this.callback.getElementStyle[t]){var n=this.callback.getElementStyle[t]
return n(a,i)}if(a){var s=e(a),r=e(i.value)
return s.indexOf(r)>=0?"selected":"default"}return"default"},this.eId=function(t){return s+"_el_"+t},this.parseElementData=function(t,a,i,n,r){if(i||(i={}),"function"==typeof this.callback.parseElementData[t]){var l=this.callback.parseElementData[t]
i=l(a,i)}var h=["accesskey","name","class","dir","id","lang","style","tabindex","title","src","type","placeholder","selected","checked","readonly","disabled","target","media","href","value"],c={},o=[]
i.name=t,r>0?"select"!=n&&(i.id||(i.id=this.eId(t+"_"+r))):i.id||(i.id=this.eId(t))
var p=s+".updateState(this)"
if(!r)switch(n){case"select":i.onchange=p
break
case"input":i.onkeyup=p,i.value||(i.value=a)
break
default:n&&(i.onclick=p)}r>0&&e(a).indexOf(e(i.value))>=0&&(("select"==n||"radio"==n)&&(i.selected="selected"),"checkbox"==n&&(i.checked="checked"))
for(var f in i)c[f]=i[f],(h.indexOf(f)>=0||f.indexOf("data-")>=0||f.indexOf("on")>=0)&&o.push(f+'="'+i[f]+'"')
return c.attr=o.join(" "),c},this.node=function(t){return document.getElementById(this.eId(t))},this.style="default",this.h2n=function(t,e){var a=e.parentElement
if(a){var i=a.cloneNode()
i.innerHTML=t,a.replaceChild(i.firstChild,e)}},this.render=function(){if(this.willRender(),!this.container)throw new Error("Invalid container specified")
var t=this.style,i=this.template.main[t],n=this.cache
if(!i)throw new Error("Invalid master template for style: "+t)
var s=!1
for(var r in this.template.sub)if(this.cnf.partialRender&&e(this.state[r])==e(this.pState[r])&&"string"==typeof n[r]&&e(this.data[r])==e(this.pData[r]));else{var l=this.renderElement(r),h=this.node(r)
h?"string"==typeof l&&l.length>0&&this.h2n(l,h):"string"==typeof l&&l.length>0&&(n[r]=l,s=!0)}this.pState=a(this.state),this.pData=a(this.data),s&&(this.container.innerHTML=this.htmlTemplate(i,n),this.didRender())},this.renderElement=function(t){if("object"!=typeof this.template.sub[t])return""
var i=this.data[t]||{},n=this.state[t]||"",s=""
if("function"==typeof this.callback.renderElement[t]){var r=this.callback.renderElement[t]
return r(n,i)}var l=this.template.sub[t],h=(l._type,this)
if(l._wrapper){i.wrapper||(i.wrapper={})
var c=this.parseElementData(t,n,i.wrapper,l._type),o=i.element||[],p=0
o.map(function(i){p++
var r=a(i),c=h.getElementStyle(t,n,r),o=h.template.sub[t][c],f=h.parseElementData(t,n,r,l._type,p)
o||(o=h.template.sub[t]["default"])
var d=h.node(t+"_"+p),u=h.htmlTemplate(o,f)
if(d&&h.cnf.partialRender){var m=p-1,v=e(h.pData[t].element[m]),y=e(h.data[t].element[m])
v!=y&&h.h2n(u,d)}else s+=u}),"string"==typeof s&&s.length>1&&(s=h.htmlTemplate(l._wrapper[0],c)+s+l._wrapper[1])}else{var f=this.getElementStyle(t,n,i),d=this.template.sub[t][f],u=this.parseElementData(t,n,i,l._type)
d||(d=this.template.sub[t]["default"]),s+=this.htmlTemplate(d,u)}return s},this.init=function(t,e){t&&(this.container=t),this.load(),e!==!1&&(this.appStart(),this.render(),this.appFinish())},this.appStart=function(){},this.appFinish=function(){},this.willRender=function(){},this.didRender=function(){},this.toQuerystring=function(){var t=[]
for(var e in this.state){var a=this.state[e]
a&&t.push(e+"="+a)}return t.join("&")}},n={}
t.SimpleApp=function(t,e){return n[t]||(n[t]=new i(t,e)),n[t]},t.SimpleEvent={c:{},listen:function(t,e){this.c[t]=this.c[t]||[],this.c[t].push(e)},emit:function(t,e){if(this.c[t]&&this.c[t].length>0)for(var a in this.c[t]){var i=this.c[t][a]
try{i(e)}catch(n){}}}},"undefined"!=typeof exports&&(exports.SimpleApp=t.SimpleApp,exports.SimpleEvent=t.SimpleEvent)}(this)
