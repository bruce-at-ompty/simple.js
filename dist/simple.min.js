!function(t){"use strict"
function e(t){return document.getElementById(t)}var i=t,a=t.console,n=function(){return Date.now()},r=function(t){return 0===Object.keys(t).length},s=function(t,e){this.src=t,e=e||document.createElement("div"),this.parent=e
try{var i=this.parent.cloneNode(!1)
i.innerHTML=this.src,this.node=i.firstChild}catch(n){return void a.log("ERROR:",n)}this.left=function(t,e){var i=t
t instanceof s&&(i=t.node),e&&(this.parent=e)
try{this.parent.insertBefore(this.node,i)}catch(n){a.log("ERROR: vNode.left()",n)}},this.right=function(t){try{t&&(this.parent=t),this.parent.appendChild(this.node)}catch(e){a.log("ERROR: vNode.right()",e)}},this.replace=function(t){var e=t
t instanceof s&&(e=t.node)
try{this.parent=t.parentNode,this.parent.replaceChild(this.node,e)}catch(i){a.log("ERROR: vNode.replace()",i,t)}},this.updateHTML=function(t){try{var e=this.parent.cloneNode(!1),i=this.node
e.innerHTML=t,this.node=e.firstChild,this.parent.replaceChild(this.node,i)}catch(n){a.log("ERROR: vNode.updateHTML()",t,n)}},this.appendVNode=function(t){this.node.appendChild(t.node)},this.appendVNodes=function(t){var e=this
try{t.map(function(t){e.node.appendChild(t.node)})}catch(i){a.log("ERROR: vNode.appendVNodes()",i)}},this.remove=function(){this.node.remove()}}
i.SimpleAppStart="sta",i.SimpleAppFinish="fin",i.SimpleAppWillRender="wrd",i.SimpleAppDidRender="drd",i.SimpleAppRenderElement="rde",i.SimpleAppParseElementData="ped",i.SimpleAppStateIsUpdated="siu",String.prototype.hashCode=function(){var t,e,i,a=0
if(0===this.length)return a
for(t=0,i=this.length;i>t;t++)e=this.charCodeAt(t),a=(a<<5)-a+e,a|=0
return Math.abs(a)}
var o,h=function(t){return JSON.stringify(t)},l=function(t){return JSON.parse(h(t))}
o=function(t,o){this.aName=t,t=h(t).hashCode()
var p="_sj_"+t
if(this.name=t,i[p]=this,this.localStorageKey=p+"_data",this.container=null,this.state={},this.pState={},this.cnf={localStorageWrite:!0,localStorageRead:!0,partialRender:!0,skipEmptyData:!0},"object"==typeof o)for(var d in o)this.cnf[d]=o[d]
this.cr={sta:{},fin:{},wrd:{},drd:{},rde:{},ped:{},siu:{}},this.gc=function(t,e){return e?"function"==typeof this.cr[t][e]?this.cr[t][e]:void 0:this.cr[t]},this.on=function(t,e,i){"object"==typeof this.cr[t]&&"function"==typeof i&&(this.cr[t][e]=i)},this._f=function(t){var e=this.gc(t)
if("object"==typeof e)for(var i in e){var n=e[i]
"function"==typeof n&&(a.log(">> calls - "+i,e),n())}},this.updateState=function(t,e){var i,n,r
if("string"==typeof t)a.log("=> update state by name/value",t,e),i=t,n=e,this.state[t]=e
else if("object"==typeof t&&"string"==typeof t.nodeName){a.log("=> update state by element",t),r=t
var s=r.nodeName,o=r.type
switch("SELECT"==s&&(o="select"),i=r.name,n=r.value,o){case"select":case"text":case"radio":this.state[i]=n
break
case"checkbox":if(this.state[i]||(this.state[i]=[]),r.checked&&n.length>0)this.state[i].indexOf(n)<0&&this.state[i].push(n)
else{var h=this.state[i].indexOf(n)
h>=0&&this.state[i].splice(h,1)}break
default:this.state[i]=n}}this.store(),this.stateIsUpdated({name:i,value:n,element:r,state:this.state})},this.stateIsUpdated=function(t){var e=this.gc("siu",t.name)
return"function"==typeof e?e(t):t},this.htpl=function(t,e,i){i=i===!0
try{var n=t
for(var r in e)if(r.length>0){var s=new RegExp("{"+r+"}","g"),o=e[r]
n=n.replace(s,o)}return i!==!0&&(n=n.replace(/{[^<>}]+}/gi,"").replace(/{>([^}]+)}/gi,"{$1}")),n}catch(h){return a.log("[Error] html template failure",h),""}},this.store=function(){this.cnf.localStorageWrite&&"object"==typeof i.localStorage&&i.localStorage.setItem(this.localStorageKey,h(this.state))},this.load=function(){if(this.cnf.localStorageRead&&"object"==typeof i.localStorage){var t=i.localStorage.getItem(this.localStorageKey)
if(!t)return
try{this.state=JSON.parse(t)}catch(e){a.log("[ERROR] Unable to parse state "+t,e)}}},this.template={main:{},sub:{}},this.data={},this.pData={},this.els=function(t,e,i){if(i._style)return a.log(">>> Style for "+t+": "+i._style),i._style
if(e){var n=h(e),r=h(i.value)
return n.indexOf(r)>=0?"selected":"default"}return"default"},this.eId=function(t){return p+"_el_"+t},this.parseElementData=function(t,e,i,n,r){i||(i={})
var s=this.gc("ped",t)
if("function"==typeof s)return s(e,i)
var o={},l=[]
i.name=t,r>0?"select"!=n&&(i.id||(i.id=this.eId(t+"_"+r))):i.id||(i.id=this.eId(t))
var d=p+".updateState(this)"
if(!r)switch(n){case"select":i.onchange=d
break
case"input":i.onkeyup=d,i.value||(i.value=e)
break
default:n&&(i.onclick=d)}o.selectState="",r>0&&h(e).indexOf(h(i.value))>=0&&(a.log("check select: "+e+" <> "+i.value),"select"==n&&(i.selected="selected",o.selectState='selected="selected"'),("checkbox"==n||"radio"==n)&&(i.checked="checked",o.selectState='checked="checked"'))
for(var c in i)o[c]=i[c],c.indexOf("_")<0&&l.push(c+'="'+i[c]+'"')
return o.attr=l.join(" "),o.action=d,"welcomeStyle"==t&&a.log(">>> parseElementData",o),o},this.node=function(t){return e(this.eId(t))},this.style="default",this.render=function(t){var e=n()
if(a.log("=> Start Rendering "+this.aName),this._f("wrd"),!this.container)throw new Error("Invalid container specified")
var i=this.template.main[this.style],s={}
if(!i)throw new Error("Invalid master template for style: "+this.style)
if(t===!0&&(this.pData={}),r(this.data)||h(this.pData)==h(this.data))return void a.log("No data found, nothing will be rendered")
var o=r(this.pData)
for(var p in this.template.sub){a.log("=> Render sub: "+p)
var d=this.renderElement(p,o)
d&&(s[p]=d)}(o||!r(s))&&(this.container.innerHTML=this.htpl(i,s)),this.pState=l(this.state),this.pData=l(this.data),this._f("drd"),a.log("=> Finish Rendering in "+(n()-e)+" ms")},this.renderElement=function(t,e){e=e===!0
var i=this.data[t]||{},n=this.state[t]||"",o=""
if("object"!=typeof this.template.sub[t]||r(i)&&this.cnf.skipEmptyData===!0){if(a.log("[Warning] No element template found or empty data for "+t),this.cnf.partialRender&&!e){var p=this.node(t)
if(p)return a.log("No data found, remove node"),p.parentNode.removeChild(p),!1}return""}var d=this.gc("rde",t)
if("function"==typeof d)return d(n,i)
if(h(this.data[t])==h(this.pData[t]))return!1
var c=this.template.sub[t],f=(c._type,this)
if(c._wrapper){i.wrapper||(i.wrapper={})
var u=this.parseElementData(t,n,i.wrapper,c._type),m=i.element||[],v=0,g=this.pData[t],y=[]
g?y=l(g.element):e=!0
var S=!1
if(m.map(function(i){v++
var r=l(i),p=f.els(t,n,r),d=f.template.sub[t][p],u=f.parseElementData(t,n,r,c._type,v)
if(d||(d=f.template.sub[t]["default"]),"select"==c._type)return void(o+=f.htpl(d,u))
if(f.cnf.partialRender&&!e){var m=v-1,g=f.pData[t].element[m],y=f.data[t].element[m],R=null
if(h(g)==h(y))return
var b=f.node(t+"_"+v)
S||(S=b.parentNode),R=f.htpl(d,u)
var E
S&&(b?R&&(E=new s(R,S),E.replace(b)):S?(E=new s(R,S),E.right()):a.log("[ERROR] unable to find node parent, can not append"))}else o+=f.htpl(d,u)}),S&&y.length>m.length&&y.map(function(e,i){if(i>=v){var n=f.node(t+"_"+i)
a.log("Remove child: "+i),n&&S.removeChild(n)}}),!("string"==typeof o&&o.length>1))return a.log("=> Render Element ["+t+"]: using DOM."),!1
o=f.htpl(c._wrapper[0],u)+o+c._wrapper[1]}else{a.log(">>> render ["+t+"] as a whole")
var R=this.els(t,n,i),b=this.template.sub[t][R],E=this.parseElementData(t,n,i,c._type)
b||(b=this.template.sub[t]["default"]),o=this.htpl(b,E)}if(this.template.sub[t]._sibling){var _=this.node(this.template.sub[t]._sibling)
if(_){var w=new s(o,_.parentNode)
return w.right(),!1}}if(!e&&this.cnf.partialRender===!0&&o){var N=this.node(t),D=null
if(N)return D=new s(o),D.replace(N),!1}return o},this.init=function(t,e){t&&(this.container=t),this.load(),e!==!1&&(this._f("sta"),this.render(),this._f("fin"))},this.toQuerystring=function(){var t=[]
for(var e in this.state){var i=this.state[e]
i&&t.push(e+"="+i)}return t.join("&")},this.d=function(t,e){return e?"object"==typeof this.data[t].element&&this.data[t].element[e]?this.data[t].element[e]:void 0:this.data[t]}}
var p={}
i.SimpleApp=function(t,e){return p[t]||(p[t]=new o(t,e)),p[t]},"undefined"!=typeof exports&&(exports.SimpleApp=i.SimpleApp,exports.SimpleEvent=i.SimpleEvent)}(this)
